<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Data Gator: Atlas EZO-pH Sensor (UART/I2C)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="alligator_icon_256.png"/></td>
  <td id="projectalign">
   <div id="projectname">Data Gator
   </div>
   <div id="projectbrief">Hardware and software documentation for the Data Gator project.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_documentation_2sensors__and__wiring_2Atlas__EZO-pH__UART__I2C_2README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Atlas EZO-pH Sensor (UART/I2C)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md60"></a> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Resource   </th><th class="markdownTableHeadCenter">Contents    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a href="https://atlas-scientific.com/kits/ph-kit/#">Purchase Link</a>   </td><td class="markdownTableBodyCenter">Pricing, specs, and links to documentation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a href="https://files.atlas-scientific.com/pH_EZO_Datasheet.pdf">Datasheet</a>   </td><td class="markdownTableBodyCenter">Documentation of wiring and usage in UART/I2C mode   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md61"></a>
EZO-pH Module</h3>
<p><img src="images/ezo-ph_only.png" alt="ezo ph without carrier board" class="inline"/> </p>
<h3><a class="anchor" id="autotoc_md62"></a>
EZO-pH Module on Carrier Board (top view)</h3>
<p>Note that the pin labels on the bottom of the carrier board(purple) correspond to the I2C mode pin mapping. <img src="images/ezo-ph_and_carrier_board.png" alt="ezo_ph with carrier board" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md63"></a>
Usage</h1>
<p>By default this sensor is factory configured to operate in UART mode. This is great because it allows the user to interface with the sensor using a laptop or other PC using a USB-to-Serial converter, often an FTDI cable.</p>
<p>However, in cases where multiple sensors are needed or for embedded applications it is more helpful to calibrate and configure the sensor's parameters in UART mode and then change to I2C mode for use with an embedded system like the Data Gator.</p>
<p>The steps for this process are listed below:</p>
<ol type="1">
<li>Connect sensor to PC using FTDI cable.</li>
<li>Calibrate and configure sensor using the serial interface.</li>
<li>Set sensor to I2C mode and configure address as needed.</li>
<li>Connect sensor to DG and use!</li>
</ol>
<p>Instructions for each of these steps will be included below.</p>
<h2><a class="anchor" id="autotoc_md64"></a>
Connecting to Sensor via FTDI Cable</h2>
<p>FTDI cables will have a USB connector on one end while the other end will have jumper connectors to interface between the FTDI chip and the sensor or micro-controller. The connection table lists which wires should be connected between the sensor carrier board and the FTDI cable.</p>
<h3><a class="anchor" id="autotoc_md65"></a>
FTDI-to-EZO-pH Connection Table</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">FTDI   </th><th class="markdownTableHeadCenter">EZO-pH Carrier Board    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">GND    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CTS   </td><td class="markdownTableBodyCenter">Not Connected(NC)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">VCC(or 5V from USB)   </td><td class="markdownTableBodyCenter">VCC    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">TXD   </td><td class="markdownTableBodyCenter">RX    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">RXD   </td><td class="markdownTableBodyCenter">TX    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">DTA   </td><td class="markdownTableBodyCenter">NC   </td></tr>
</table>
<h5>NOTE</h5>
<p>It is important that the TXD of the FTDI be connected to the RX of the EZO-pH board and vice a versa for the RXD and TX pins. If TXD is connected to TX and RXD to RX, no data will be transmitted to or from the board.</p>
<h3><a class="anchor" id="autotoc_md66"></a>
Opening Serial Interface on PC</h3>
<p>There are a few serial monitor options available, but since this project is built and maintained with PlatformIO, these instructions will use the built-in serial monitor.</p>
<p>To open the serial monitor enter the following command in your terminal(or the visual studio code terminal): </p><pre class="fragment">pio device monitor -b 9600
</pre><p> This will open a serial monitor running at 9600 baud, the default baud rate of the sensor.</p>
<p>If you notice all data is being printed on one line, try using the command below to modify the newline character of the terminal. </p><pre class="fragment">pio device monitor -b 9600 --eol CR
</pre><p> This has been observed to work better in some cases because the carriage return character is the command and data transmission terminator used by the EZO-pH module whereas the default line terminator in the PlatformIO serial monitor is CRLF(carriage return followed by a line feed).</p>
<p>The default sensor read setting in UART mode is continuous mode, which means that readings are continuously taken from the sensor and printed to the serial interface. To make sure this is happening:</p>
<ol type="1">
<li>Check that the module is powered on. If so, the LED should be blinking green and blue. If not, the module is not powered on so check wiring and USB connection.</li>
<li>Verify that the TXD and RXD lines are properly wired. If they are, you should see a pH value printed to the serial monitor every couple of seconds.</li>
</ol>
<h5>If you see nothing or gibberish printed to the terminal, but the LED on the module is ON</h5>
<p>Check to make sure your TXD and RXD lines are wired correctly, maybe try swapping them.</p>
<h2><a class="anchor" id="autotoc_md67"></a>
Calibrating Sensor via Serial Interface</h2>
<p>Once you have a serial monitor open and are receiving data from the device, you should be able to use the commands defined by Atlas Scientific for controlling the device. These are well documented in the datasheet linked at the top of this guide.</p>
<p>As stated by the documentation, the process for calibrating the module is as follows:</p>
<ol type="1">
<li>Read the 7.0 pH buffer with the sensor. Once the readings have stabilized enter the command <code>Cal, mid, &lt;pH_reading_here&gt;</code> and press enter to submit the command with a carriage return. If successful, the sensor module should respond by printing <code>*OK</code> to the monitor.<ul>
<li><em><b>Note:</b></em> Sending the midpoint calibration command(above) clears all other calibration data on the chip. This is because calibrating the midpoint equates to a single point calibration.</li>
</ul>
</li>
<li>Read the 4.0 pH buffer. Then enter <code>Cal, low, &lt;pH_reading_here&gt;</code>.</li>
<li>Finally read the 10.0 pH buffer and calibrate with <code>Cal, high, &lt;pH_reading_here&gt;</code>.</li>
</ol>
<p>Once those commands are executed, the calibration status of the sensor can be queried with <code>Cal,?</code> which will return <code>?Cal,0</code> if not calibrated, or <code>?Cal,&lt;number_1-3&gt;</code> to indicate calibration with however calibration points were used.</p>
<h2><a class="anchor" id="autotoc_md68"></a>
Set Sensor to I2C Mode and Configuring Address</h2>
<p>Use command </p><pre class="fragment">`I2C,&lt;i2c_addr_here&gt;` 
</pre><p> to set I2C address and reboot in I2C mode. After rebooting the LED should remain blue to indicate that it is operating in I2C mode.</p>
<p>The I2C address should be chosen from three possible values, <code>0x01</code>, <code>0x02</code>, or <code>0x03</code>. No more than one pH sensor with the same address may be connected to the same aggregator at a time, and the address assigned should correspond to the relative depth that the sensor is buried at with <code>0x01</code> being the most shallow.</p>
<h2><a class="anchor" id="autotoc_md69"></a>
Wiring to DGv1.5+</h2>
<p>Below is the connection table for the EZO-pH carrier board when in I2C mode.</p>
<h3><a class="anchor" id="autotoc_md70"></a>
EZO-pH-to-I2C Connection Table</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Atlas EZO-pH (top label)   </th><th class="markdownTableHeadCenter">Atlas EZO-pH (bottom label)   </th><th class="markdownTableHeadCenter">Aggregator    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">VCC   </td><td class="markdownTableBodyCenter">VCC   </td><td class="markdownTableBodyCenter">3v3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">OFF   </td><td class="markdownTableBodyCenter">OFF   </td><td class="markdownTableBodyCenter">NC    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">GND    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">TX   </td><td class="markdownTableBodyCenter">SDA   </td><td class="markdownTableBodyCenter">SDA    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">RX   </td><td class="markdownTableBodyCenter">SCL   </td><td class="markdownTableBodyCenter">SCL   </td></tr>
</table>
<p><img src="images/ezo_carrier_i2c.jpg" alt="ezo pH carrier to connector" class="inline"/> <img src="images/ezo_i2c_connector.jpg" alt="ezo connector i2c" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
