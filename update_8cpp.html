<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Data Gator: include/update.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="alligator_icon_256.png"/></td>
  <td id="projectalign">
   <div id="projectname">Data Gator
   </div>
   <div id="projectbrief">Hardware and software documentation for the Data Gator project.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('update_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">update.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Defines utilities for managing firmware updates, using Over-The-Air updates.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;WiFi.h&gt;</code><br />
<code>#include &lt;WiFiMulti.h&gt;</code><br />
<code>#include &lt;HTTPClient.h&gt;</code><br />
<code>#include &lt;HTTPUpdate.h&gt;</code><br />
<code>#include &lt;tinyxml2.h&gt;</code><br />
<code>#include &lt;MQTTMailer.hpp&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for update.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="update_8cpp__incl.png" border="0" usemap="#ainclude_2update_8cpp" alt=""/></div>
<map name="ainclude_2update_8cpp" id="ainclude_2update_8cpp">
<area shape="rect" title="Defines utilities for managing firmware updates, using Over&#45;The&#45;Air updates." alt="" coords="300,5,445,31"/>
<area shape="rect" title=" " alt="" coords="5,79,89,104"/>
<area shape="poly" title=" " alt="" coords="321,33,103,81,102,75,320,28"/>
<area shape="rect" title=" " alt="" coords="113,79,176,104"/>
<area shape="poly" title=" " alt="" coords="337,33,190,79,188,74,335,28"/>
<area shape="rect" title=" " alt="" coords="200,79,295,104"/>
<area shape="poly" title=" " alt="" coords="354,33,281,74,278,69,351,28"/>
<area shape="rect" title=" " alt="" coords="319,79,426,104"/>
<area shape="poly" title=" " alt="" coords="375,31,375,65,370,65,370,31"/>
<area shape="rect" title=" " alt="" coords="450,79,565,104"/>
<area shape="poly" title=" " alt="" coords="396,28,474,70,472,74,393,33"/>
<area shape="rect" title=" " alt="" coords="589,79,681,104"/>
<area shape="poly" title=" " alt="" coords="416,28,580,72,579,78,414,33"/>
<area shape="rect" title=" " alt="" coords="706,79,834,104"/>
<area shape="poly" title=" " alt="" coords="437,28,693,74,692,79,436,33"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="update_8cpp__dep__incl.png" border="0" usemap="#ainclude_2update_8cppdep" alt=""/></div>
<map name="ainclude_2update_8cppdep" id="ainclude_2update_8cppdep">
<area shape="rect" title="Defines utilities for managing firmware updates, using Over&#45;The&#45;Air updates." alt="" coords="5,5,151,31"/>
<area shape="rect" href="main_8cpp.html" title="Initializes device and calls routines." alt="" coords="25,79,131,104"/>
<area shape="poly" title=" " alt="" coords="81,44,81,79,75,79,75,44"/>
</map>
</div>
</div>
<p><a href="update_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:adfcee2bc2c9061968f9738d7ddf0a396" id="r_adfcee2bc2c9061968f9738d7ddf0a396"><td class="memItemLeft" align="right" valign="top"><a id="adfcee2bc2c9061968f9738d7ddf0a396" name="adfcee2bc2c9061968f9738d7ddf0a396"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>OTA_SERVER</b>&#160;&#160;&#160;&quot;192.168.50.10&quot;</td></tr>
<tr class="separator:adfcee2bc2c9061968f9738d7ddf0a396"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9b133af72f24d9221d811ae375854631" id="r_a9b133af72f24d9221d811ae375854631"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8cpp.html#a9b133af72f24d9221d811ae375854631">new_firmware_version_available</a> ()</td></tr>
<tr class="memdesc:a9b133af72f24d9221d811ae375854631"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if server has different firmware version.  <br /></td></tr>
<tr class="separator:a9b133af72f24d9221d811ae375854631"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59d61902e825ebabe0a2259ba8e906ac" id="r_a59d61902e825ebabe0a2259ba8e906ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8cpp.html#a59d61902e825ebabe0a2259ba8e906ac">update_progress</a> (int cur, int total)</td></tr>
<tr class="memdesc:a59d61902e825ebabe0a2259ba8e906ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints update process progress to the serial interface.  <br /></td></tr>
<tr class="separator:a59d61902e825ebabe0a2259ba8e906ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac30dfa0188e237f4ae0f983a8dd84888" id="r_ac30dfa0188e237f4ae0f983a8dd84888"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8cpp.html#ac30dfa0188e237f4ae0f983a8dd84888">update_started</a> ()</td></tr>
<tr class="memdesc:ac30dfa0188e237f4ae0f983a8dd84888"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send status message to the MQTT broker that the update process started.  <br /></td></tr>
<tr class="separator:ac30dfa0188e237f4ae0f983a8dd84888"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ab67b93fc9ac13fed541d66e044a039" id="r_a4ab67b93fc9ac13fed541d66e044a039"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8cpp.html#a4ab67b93fc9ac13fed541d66e044a039">update_finished</a> ()</td></tr>
<tr class="memdesc:a4ab67b93fc9ac13fed541d66e044a039"><td class="mdescLeft">&#160;</td><td class="mdescRight">Log update process finished.  <br /></td></tr>
<tr class="separator:a4ab67b93fc9ac13fed541d66e044a039"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91745750976b456ed74139d5c6a07473" id="r_a91745750976b456ed74139d5c6a07473"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8cpp.html#a91745750976b456ed74139d5c6a07473">update_error</a> (int err)</td></tr>
<tr class="memdesc:a91745750976b456ed74139d5c6a07473"><td class="mdescLeft">&#160;</td><td class="mdescRight">Log update process errored out.  <br /></td></tr>
<tr class="separator:a91745750976b456ed74139d5c6a07473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac73e1e13b3305f391b3319037813e9b0" id="r_ac73e1e13b3305f391b3319037813e9b0"><td class="memItemLeft" align="right" valign="top"><a id="ac73e1e13b3305f391b3319037813e9b0" name="ac73e1e13b3305f391b3319037813e9b0"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>attempt_update</b> ()</td></tr>
<tr class="separator:ac73e1e13b3305f391b3319037813e9b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a45a3fd1220b5c8c7557fb18db8c20e50" id="r_a45a3fd1220b5c8c7557fb18db8c20e50"><td class="memItemLeft" align="right" valign="top">const bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8cpp.html#a45a3fd1220b5c8c7557fb18db8c20e50">USB_DEBUG</a></td></tr>
<tr class="separator:a45a3fd1220b5c8c7557fb18db8c20e50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a965861de1a367ef4c2b467de34de2683" id="r_a965861de1a367ef4c2b467de34de2683"><td class="memItemLeft" align="right" valign="top"><a id="a965861de1a367ef4c2b467de34de2683" name="a965861de1a367ef4c2b467de34de2683"></a>
PubSubClient&#160;</td><td class="memItemRight" valign="bottom"><b>mqtt_client</b></td></tr>
<tr class="separator:a965861de1a367ef4c2b467de34de2683"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Defines utilities for managing firmware updates, using Over-The-Air updates. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a9b133af72f24d9221d811ae375854631" name="a9b133af72f24d9221d811ae375854631"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b133af72f24d9221d811ae375854631">&#9670;&#160;</a></span>new_firmware_version_available()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string new_firmware_version_available </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if server has different firmware version. </p>
<p>Accesses the server using the IP address defined by OTA_SERVER. If the server hosted version of doesn't match then the firmware file name is retrieved and the file downloaded from the server.</p>
<p>Status messages are logged to serial and the MQTT broker if possible. </p>

</div>
</div>
<a id="a91745750976b456ed74139d5c6a07473" name="a91745750976b456ed74139d5c6a07473"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91745750976b456ed74139d5c6a07473">&#9670;&#160;</a></span>update_error()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update_error </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>err</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Log update process errored out. </p>
<p>Notifies the MQTT broker and prints the update error message to the serial line. The message on the serial port will contain the HTTP error code. Logging error code is not included in MQTT message since most likely failure is connection. </p>

</div>
</div>
<a id="a4ab67b93fc9ac13fed541d66e044a039" name="a4ab67b93fc9ac13fed541d66e044a039"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ab67b93fc9ac13fed541d66e044a039">&#9670;&#160;</a></span>update_finished()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update_finished </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Log update process finished. </p>
<p>Notifies the MQTT broker and prints the update finished message to the serial line. </p>

</div>
</div>
<a id="a59d61902e825ebabe0a2259ba8e906ac" name="a59d61902e825ebabe0a2259ba8e906ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59d61902e825ebabe0a2259ba8e906ac">&#9670;&#160;</a></span>update_progress()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update_progress </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>total</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints update process progress to the serial interface. </p>
<p>Prints number of bytes downloaded out of the total file size to serial interface, but only if the USB_DEBUG flag is set.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cur</td><td>bytes downloaded so far </td></tr>
    <tr><td class="paramname">total</td><td>total file size in bytes </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac30dfa0188e237f4ae0f983a8dd84888" name="ac30dfa0188e237f4ae0f983a8dd84888"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac30dfa0188e237f4ae0f983a8dd84888">&#9670;&#160;</a></span>update_started()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update_started </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send status message to the MQTT broker that the update process started. </p>
<p>Notifies MQTT broker and prints to the serial interface that the device has begun updating from the server hosted file. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a45a3fd1220b5c8c7557fb18db8c20e50" name="a45a3fd1220b5c8c7557fb18db8c20e50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45a3fd1220b5c8c7557fb18db8c20e50">&#9670;&#160;</a></span>USB_DEBUG</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const bool USB_DEBUG</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Serial debug enable flag, set in config.h </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="update_8cpp.html">update.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
